# 卓越性能

仓颉在计算机基本测试 Benchmarks Game 上，比 Java、Go 的性能还要好很多。

## 静态编译优化

仓颉编译采用模块化编译，将编译过程分解成多个独立的模块，每个模块负责一个特定的编译任务。编译流程间通过 IR（Intermediate Representation）代码中间表示 作为载体，这样的好处是将源代码抽象表示，将 IR 作为不同编译阶段的桥梁，因此能够做到不同编译优化之间解耦，互不影响。

仓颉还会通过静态编译，将仓颉程序，核心代码直接编译成机器代码，加速程序运行速度。

仓颉静态编译中，添加了许多运行时联合优化：

- 堆上对象读写优化
  - 内存对齐：64 位的计算机，处理器一次处理 8 字节的数据，如果不对数据进行 8 字节的对齐，那么一个 4 字节的数据，处理器可能需要进行两次内存访问来获取数据。总而言之，内存对齐，就像流水线上将商品按固定间距摆放，以统一的标准提升效率。
  - 延迟加载：对于不常用的对象属性，延迟加载，在需要的时候再加载到内存中。
- 堆对象创建优化：
  - 对象池：使用对象池复用对象实例，避免频繁的内存分配和垃圾回收。
  - 内存池：预先分配一大块内存，并且分割为固定大小的小内存块，当需要创建对象的时候，通过指针操作直接分配一块空闲的内存块，而不是重新`malloc`
- 堆内存管理信号机制的优化：当发生特定事件，例如内存分配失败、内存违规访问，操作系统会通过信号机制向进程异步发送信号。堆内存管理的信号机制的优化指的是通过减少内存分配失败，减少内存违规访问等等，从而减少信号发生的频率。

仓颉静态后端（将 IR 编译成目标机器代码）通过向量化（一次性处理数据集合中的多个元素，可以简单理解批量处理数据）减少函数调用对性能的影响。

活跃作用域分析：静态分析指针引用关系，确定活跃作用域，从而可以更好的分配和管理内存，例如只在它活跃的时候分配内存。
